using System.Linq;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Authorization;
using PenTestSQL.Data;
using Microsoft.EntityFrameworkCore;
using PenTestSQL.Models;

// For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860

namespace PenTestSQL.Controllers
{
    public class VotesController : Controller
    {
        private ApplicationDbContext _appDdContext;

        public VotesController(ApplicationDbContext appDdContext)
        {
            _appDdContext = appDdContext;
        }
        
        [Authorize]
        public IActionResult Index(int motorBikeId)
        {
            var votes = _appDdContext.Votes.Include(v=>v.MotorBikes).Include(v=>v.User).Where(x => x.MotorBikeId == motorBikeId);

            var votesVM = new VoteViewModel
            {
                Votes = votes.ToList()
            };

            return View(votesVM);
        }
    }
}
